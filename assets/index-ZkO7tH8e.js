import{r as o,j as e,G as i,T as C,B as h,L as p,I as b,d as Q,c as X,a as Y,D as Z,u as ee}from"./index-C57bLDxE.js";import{I as N,C as se,M as ne,c as le,u as te,L as ae,a as oe,n as M,s as ce,P as re,b as ie,d as ue,S as de}from"./ContextPopup-B7L7NGoK.js";import{u as me,H as xe,b as V,P as f,A as y,M as he,a as S}from"./trashcan-CiGn7zZY.js";import{C as v}from"./Collapser-qxTAF6TF.js";import{S as $}from"./Switch-DrjPlum3.js";const w=(s,n)=>(s/10**n).toLocaleString("ru-RU",{minimumFractionDigits:n,maximumFractionDigits:n}),je="_input_1rku8_1",pe={input:je},L=o.memo(({label:s,name:n,rules:l,control:a,precision:t=0,autoFocus:c,cs:u={}})=>{const{field:{onChange:r,onBlur:m,value:g,ref:T},fieldState:{error:D}}=me({name:n,rules:l,control:a}),[B,q]=o.useState("");o.useEffect(()=>{Number.isInteger(g)||r(0)},[]),o.useEffect(()=>{Number.isInteger(g)&&q(w(g,t).replaceAll(" ",""))},[t,g]);const H=_=>{var F;const W=_.target,P=W.value,k=P.replace(/[^\d.,-]/g,"").replace(".",",").replace(/(?!^)-/g,"");let d=W.selectionStart;const R=k.indexOf(","),U=R===-1?d:R,A=k.replaceAll(",",""),G=new RegExp(`^(.{${U}})(.*)$`),x=A.match(G),O=(t===0?A:x==null?void 0:x[1])||"0",z=((x==null?void 0:x[2])||"0").substring(0,t).padEnd(t,"0"),J=parseInt(O+z),E=_.nativeEvent.inputType==="insertText",K=new RegExp(`(.{${d-1}})(.)(.*)`),I=(F=P.match(K))==null?void 0:F[2];E&&/[^\d,]/.test(I)&&d--,E&&/-/.test(I)&&d===0&&d++,r(J),requestAnimationFrame(()=>setTimeout(()=>W.setSelectionRange(d,d),0))};return e.jsxs("label",{children:[e.jsx(xe,{className:u.header,label:s,error:D}),e.jsx("input",{className:pe.input,onChange:H,onBlur:m,value:B,ref:T,type:"text",autoFocus:c})]})}),be=({controls:s})=>{const n=p.addWallet,{control:l,formState:{isValid:a},handleSubmit:t,reset:c}=V({mode:"onChange",defaultValues:{name:""}}),u=r=>{n(r),c(),s.close()};return e.jsx(f,{controls:s,minWidth:300,children:e.jsxs(i,{column:!0,children:[e.jsx(C,{children:"Добавить счет"}),e.jsxs("form",{onSubmit:t(u),children:[e.jsx(f.Scroller,{children:e.jsxs(i,{column:!0,children:[e.jsx(N,{label:"Название",placeholder:"Наличные...",name:"name",rules:{required:"Обязательное"},control:l,autoFocus:!0}),e.jsx(L,{label:"Баланс",name:"balance",precision:2,control:l}),e.jsx($,{label:"Сделать основным",name:"main",control:l})]})}),e.jsxs(y,{children:[e.jsx(h,{type:"submit",visualDisabled:!a,children:"Добавить"}),e.jsx(h,{onClick:s.close,children:"Отмена"})]})]})]})})},fe=({handleModifyWallet:s,handleRemoveWallet:n,controls:l})=>{const a=(t=()=>{})=>()=>{l.close(),t()};return e.jsx(se,{controls:l,children:e.jsxs(i,{column:!0,children:[e.jsx(b,{icon:ne,label:"Изменить",onClick:a(s)}),e.jsx(b,{icon:he,label:"Удалить",onClick:a(n)})]})})};Q.extend(X);const Ce=({id:s,controls:n})=>{const l=p.getWallet(s),a=p.modifyWallet,{control:t,formState:{isValid:c},handleSubmit:u}=V({mode:"onChange",defaultValues:{name:l.name,balance:l.balance,main:l.main}}),r=m=>{a(s,m),n.close()};return e.jsx(f,{controls:n,minWidth:300,children:e.jsxs(i,{column:!0,children:[e.jsx(C,{children:"Изменить счет"}),e.jsxs("form",{onSubmit:u(r),children:[e.jsx(f.Scroller,{children:e.jsxs(i,{column:!0,children:[e.jsx(N,{label:"Название",placeholder:"Наличные...",name:"name",rules:{required:"Обязательное"},control:t,autoFocus:!0}),e.jsx(L,{label:"Баланс",name:"balance",precision:2,control:t}),e.jsx($,{label:"Сделать основным",name:"main",control:t})]})}),e.jsxs(y,{children:[e.jsx(h,{type:"submit",visualDisabled:!c,children:"Сохранить"}),e.jsx(h,{onClick:n.close,children:"Отмена"})]})]})]})})},ge=({id:s,controls:n})=>{const l=p.getWallet(s),a=p.removeWallet,t=()=>{a(s),n.close()};return e.jsx(f,{controls:n,maxWidth:320,children:e.jsxs(i,{column:!0,children:[e.jsx(C,{children:"Удаление задачи"}),e.jsxs("p",{children:['Вы действительно хотите удалить счет "',l.name,'"?']}),e.jsx("p",{children:"Это также удалит все его операции"}),e.jsxs(y,{children:[e.jsx(h,{onClick:t,children:"Удалить"}),e.jsx(h,{onClick:n.close,children:"Отмена"})]})]})})},Se="_Wallet_c7p7y_1",We="_header_c7p7y_5",ve="_button_c7p7y_10",ye="_inner_c7p7y_14",_e="_main_c7p7y_18",j={Wallet:Se,header:We,button:ve,inner:ye,main:_e},Pe=o.memo(({wallet:{id:s,name:n,balance:l,main:a}})=>{const t=o.useRef(null),c=o.useCallback(()=>le(t.current),[t]),u=te(c),r=S(),m=S();return e.jsxs(ae,{className:j.Wallet,children:[e.jsxs(i,{column:!0,children:[e.jsxs(i,{className:j.header,children:[e.jsx(C,{children:n}),e.jsx(b,{className:j.button,cs:{inner:j.inner},ref:t,icon:oe,onClick:u.open})]}),e.jsxs("p",{children:["Баланс: ",w(l,2),a&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsx("span",{className:j.main,children:"основной"})]})]})]}),e.jsx(fe,{handleModifyWallet:r.open,handleRemoveWallet:m.open,controls:u}),e.jsx(Ce,{id:s,controls:r}),e.jsx(ge,{id:s,controls:m})]})}),ke={id:M("id"),name:ce("name"),balance:M("balance")},Re=o.memo(({sort:s})=>{const n=Y(a=>a.wallets),l=o.useMemo(()=>ke[(s==null?void 0:s.field)??"id"][(s==null?void 0:s.order)??"desc"](n),[n,s]);return e.jsxs(Z,{timeout:500,children:[n.length===0&&e.jsx(v,{children:e.jsx(C,{center:!0,indent:!0,children:"Счетов не найдено"})}),l.map(a=>e.jsx(v,{children:e.jsx(Pe,{wallet:a})},a.id))]})}),Ae=[{value:"id",label:"По умолчанию"},{value:"name",label:"По названию"},{value:"balance",label:"По балансу"}],Ee={id:[{value:"desc",label:"Сначала последние"},{value:"asc",label:"Сначала первые"}],name:[{value:"asc",label:"В алфавитном порядке"},{value:"desc",label:"В обратном порядке"}],balance:[{value:"asc",label:"От наименьшего"},{value:"desc",label:"От наибольшего"}]},$e=()=>{const s=ee(c=>c.setCurrentPageTitle);o.useLayoutEffect(()=>s("Счета"));const n=S(),l=S(),[a,t]=o.useState(null);return e.jsxs(v,{children:[e.jsx(Re,{sort:a}),e.jsx(re,{children:e.jsxs(i,{children:[e.jsx(b,{icon:ie,onClick:()=>n.open()}),e.jsx(b,{icon:ue,onClick:()=>l.open()})]})}),e.jsx(be,{controls:n}),e.jsx(de,{controls:l,setSort:t,fields:Ae,orders:Ee})]})};export{$e as Wallets};
