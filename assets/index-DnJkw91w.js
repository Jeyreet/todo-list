import{j as e,G as o,T as b,B as u,L as x,I as h,d as k,c as M,r,a as g,D as L,u as F}from"./index-Drd5J5gP.js";import{I as v,C as I,M as N,c as R,u as w,L as A,a as T,n as S,s as $,P as D,b as V,d as B,S as E}from"./ContextPopup-BhxJ9_H_.js";import{b as y,P as j,S as _,A as W,M as q,a as C}from"./Switch-DnfmqdMb.js";import{C as f}from"./Collapser-DASlPNaZ.js";import{N as P,m as G}from"./NumberInput-C89ehNoI.js";const U=({controls:s})=>{const l=x.addWallet,{control:n,formState:{isValid:a},handleSubmit:t,reset:c}=y({mode:"onChange",defaultValues:{name:""}}),i=d=>{l(d),c(),s.close()};return e.jsx(j,{controls:s,minWidth:300,children:e.jsxs(o,{column:!0,children:[e.jsx(b,{children:"Добавить счет"}),e.jsxs("form",{onSubmit:t(i),children:[e.jsx(j.Scroller,{children:e.jsxs(o,{column:!0,children:[e.jsx(v,{label:"Название",placeholder:"Наличные...",name:"name",rules:{required:"Обязательное"},control:n,autoFocus:!0}),e.jsx(P,{label:"Баланс",name:"balance",precision:2,control:n}),e.jsx(_,{label:"Сделать основным",name:"main",control:n})]})}),e.jsxs(W,{children:[e.jsx(u,{type:"submit",visualDisabled:!a,children:"Добавить"}),e.jsx(u,{onClick:s.close,children:"Отмена"})]})]})]})})},H=({handleModifyWallet:s,handleRemoveWallet:l,controls:n})=>{const a=(t=()=>{})=>()=>{n.close(),t()};return e.jsx(I,{controls:n,children:e.jsxs(o,{column:!0,children:[e.jsx(h,{icon:N,label:"Изменить",onClick:a(s)}),e.jsx(h,{icon:q,label:"Удалить",onClick:a(l)})]})})};k.extend(M);const O=({id:s,controls:l})=>{const n=x.getWallet(s),a=x.modifyWallet,{control:t,formState:{isValid:c},handleSubmit:i}=y({mode:"onChange",defaultValues:{name:n.name,balance:n.balance,main:n.main}}),d=p=>{a(s,p),l.close()};return e.jsx(j,{controls:l,minWidth:300,children:e.jsxs(o,{column:!0,children:[e.jsx(b,{children:"Изменить счет"}),e.jsxs("form",{onSubmit:i(d),children:[e.jsx(j.Scroller,{children:e.jsxs(o,{column:!0,children:[e.jsx(v,{label:"Название",placeholder:"Наличные...",name:"name",rules:{required:"Обязательное"},control:t,autoFocus:!0}),e.jsx(P,{label:"Баланс",name:"balance",precision:2,control:t}),e.jsx(_,{label:"Сделать основным",name:"main",control:t})]})}),e.jsxs(W,{children:[e.jsx(u,{type:"submit",visualDisabled:!c,children:"Сохранить"}),e.jsx(u,{onClick:l.close,children:"Отмена"})]})]})]})})},z=({id:s,controls:l})=>{const n=x.getWallet(s),a=x.removeWallet,t=()=>{a(s),l.close()};return e.jsx(j,{controls:l,maxWidth:320,children:e.jsxs(o,{column:!0,children:[e.jsx(b,{children:"Удаление задачи"}),e.jsxs("p",{children:['Вы действительно хотите удалить счет "',n.name,'"?']}),e.jsx("p",{children:"Это также удалит все его операции"}),e.jsxs(W,{children:[e.jsx(u,{onClick:t,children:"Удалить"}),e.jsx(u,{onClick:l.close,children:"Отмена"})]})]})})},J="_Wallet_c7p7y_1",K="_header_c7p7y_5",Q="_button_c7p7y_10",X="_inner_c7p7y_14",Y="_main_c7p7y_18",m={Wallet:J,header:K,button:Q,inner:X,main:Y},Z=r.memo(({wallet:{id:s,name:l,balance:n,main:a}})=>{const t=r.useRef(null),c=r.useCallback(()=>R(t.current),[t]),i=w(c),d=C(),p=C();return e.jsxs(A,{className:m.Wallet,children:[e.jsxs(o,{column:!0,children:[e.jsxs(o,{className:m.header,children:[e.jsx(b,{children:l}),e.jsx(h,{className:m.button,cs:{inner:m.inner},ref:t,icon:T,onClick:i.open})]}),e.jsxs("p",{children:["Баланс: ",G(n,2),a&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsx("span",{className:m.main,children:"основной"})]})]})]}),e.jsx(H,{handleModifyWallet:d.open,handleRemoveWallet:p.open,controls:i}),e.jsx(O,{id:s,controls:d}),e.jsx(z,{id:s,controls:p})]})}),ee={id:S("id"),name:$("name"),balance:S("balance")},se=r.memo(({sort:s})=>{const l=g(a=>a.wallets),n=r.useMemo(()=>ee[(s==null?void 0:s.field)??"id"][(s==null?void 0:s.order)??"desc"](l),[l,s]);return e.jsxs(L,{timeout:500,children:[l.length===0&&e.jsx(f,{children:e.jsx(b,{center:!0,indent:!0,children:"Счетов не найдено"})}),n.map(a=>e.jsx(f,{children:e.jsx(Z,{wallet:a})},a.id))]})}),le=[{value:"id",label:"По умолчанию"},{value:"name",label:"По названию"},{value:"balance",label:"По балансу"}],ne={id:[{value:"desc",label:"Сначала последние"},{value:"asc",label:"Сначала первые"}],name:[{value:"asc",label:"В алфавитном порядке"},{value:"desc",label:"В обратном порядке"}],balance:[{value:"asc",label:"От наименьшего"},{value:"desc",label:"От наибольшего"}]},ie=()=>{const s=F(c=>c.setCurrentPageTitle);r.useLayoutEffect(()=>s("Счета"));const l=C(),n=C(),[a,t]=r.useState(null);return e.jsxs(f,{children:[e.jsx(se,{sort:a}),e.jsx(D,{children:e.jsxs(o,{children:[e.jsx(h,{icon:V,onClick:()=>l.open()}),e.jsx(h,{icon:B,onClick:()=>n.open()})]})}),e.jsx(U,{controls:l}),e.jsx(E,{controls:n,setSort:t,fields:le,orders:ne})]})};export{ie as Wallets};
