import{r as s,d,j as e,G as j,I as b,M as P,B,b as oe,c as H,T as W,L as T,a as ae,D as de,u as ue}from"./index-Cjmt35S_.js";import{I as re,C as me,M as he,c as xe,u as pe,L as je,a as fe,s as z,n as _e,P as ve,b as Ce,d as ke,S as Me}from"./ContextPopup-CiAaXS7O.js";import{P as A,u as be,a as F,H as ge,b as Q,A as Z,M as ye}from"./trashcan-DwAlcm7J.js";import{C as J}from"./Collapser-CrOcLQbh.js";import{m as Ye,A as ce}from"./AreaInput-D-tPrfsg.js";import{S as we}from"./Switch-CIphW_gn.js";const Be=n=>s.createElement("svg",{id:"\\u0421\\u043B\\u043E\\u0439_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 24 24",style:{enableBackground:"new 0 0 24 24"},xmlSpace:"preserve",fill:"currentColor",stroke:"transparent",...n},s.createElement("path",{d:"M13,2.1C8.4,1.6,3.9,4.5,2.5,9c-1,3-0.4,6,1.1,8.4l2.5-1.6c-1.2-1.9-1.5-4.3-0.5-6.6C6.7,6.6,9.3,4.9,12.1,5 c4.6,0.1,7.7,4.3,6.7,8.5c-0.3,1.5-1.1,2.7-2.1,3.7c-0.5,0.5-0.6,1.3-0.2,1.9l0,0c0.5,0.8,1.6,0.9,2.3,0.3c1.4-1.3,2.5-3.1,3-5.2 C23,8.4,19.1,2.7,13,2.1z"}),s.createElement("path",{d:"M1.5,17.2L7,13.8c0.6-0.4,1.4,0.1,1.4,0.8l-0.1,6c0,0.7-0.7,1.1-1.3,0.8l-5.4-2.6C0.9,18.4,0.9,17.6,1.5,17.2z"})),Se=s.memo(Be),De="_controls_1dmxs_1",Ie="_monthWrapper_1dmxs_7",Te="_monthButtonInner_1dmxs_12",Ne="_nextMonthIcon_1dmxs_16",Ee="_month_1dmxs_7",Re="_yearWrapper_1dmxs_25",$e="_yearButton_1dmxs_31",Ve="_yearButtonInner_1dmxs_31",Ae="_prevYearIcon_1dmxs_44",Fe="_nextYearIcon_1dmxs_48",We="_year_1dmxs_25",Pe="_days_1dmxs_57",ze="_weekday_1dmxs_63",Le="_monthDayInner_1dmxs_67",qe="_selected_1dmxs_71",He="_resetButtonWrapper_1dmxs_75",Ke="_resetButtonInner_1dmxs_81",h={controls:De,monthWrapper:Ie,monthButtonInner:Te,nextMonthIcon:Ne,month:Ee,yearWrapper:Re,yearButton:$e,yearButtonInner:Ve,prevYearIcon:Ae,nextYearIcon:Fe,year:We,days:Pe,weekday:ze,monthDayInner:Le,selected:qe,resetButtonWrapper:He,resetButtonInner:Ke};d.extend(H);const Xe=({setDate:n,day:c,month:t,year:a,controls:l})=>{const[u,C]=s.useState(Number(t!==""?t:d().format("M")-1)),[p,m]=s.useState(Number(a!==""?a:d().format("YYYY"))),N=s.useMemo(()=>{const o=d(`1.${u+1}.${p}`,"D.M.Y").day();return o===0?6:o-1},[u,p]),E=s.useMemo(()=>d(`1.${u+1}.${p}`,"D.M.Y").daysInMonth(),[u,p]),Y=()=>{C(o=>{let x=o-1;return x<0&&(x=11,D()),x})},S=()=>{C(o=>{let x=o+1;return x>11&&(x=0,w()),x})},D=()=>{m(o=>o-1)},w=()=>{m(o=>o+1)},R=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];return e.jsx(A,{controls:l,children:e.jsxs(j,{column:!0,children:[e.jsxs("div",{className:h.controls,children:[e.jsxs("div",{className:h.monthWrapper,children:[e.jsx(b,{cs:{inner:h.monthButtonInner},icon:P,onClick:Y}),e.jsx("div",{className:h.month,children:R[u]}),e.jsx(b,{cs:{inner:h.monthButtonInner,icon:h.nextMonthIcon},icon:P,onClick:S})]}),e.jsxs("div",{className:h.yearWrapper,children:[e.jsx(b,{className:h.yearButton,cs:{inner:h.yearButtonInner,icon:h.nextYearIcon},icon:P,onClick:w}),e.jsx(b,{className:h.yearButton,cs:{inner:h.yearButtonInner,icon:h.prevYearIcon},icon:P,onClick:D}),e.jsx("div",{className:h.year,children:p})]})]}),e.jsxs("div",{className:h.days,children:[["Пн","Вт","Ср","Чт","Пт","Сб","Вс"].map(o=>e.jsx("div",{className:h.weekday,children:o},o)),Array.from({length:N}).map((o,x)=>e.jsx("div",{},x)),Array.from({length:E}).map((o,x)=>e.jsx(B,{cs:{inner:oe(h.monthDayInner,Number(c)===x+1&&Number(t)===u+1&&Number(a)===p&&h.selected)},onClick:()=>{const I=d(`${x+1}.${u+1}.${p}`,"D.M.Y");n(I.format("DD"),I.format("MM"),I.format("YYYY")),l.close()},children:x+1},x))]}),e.jsxs(j,{children:[e.jsx(B,{onClick:()=>{const o=d().subtract(1,"day");n(o.format("DD"),o.format("MM"),o.format("YYYY")),l.close()},children:"Вчера"}),e.jsx(B,{onClick:()=>{const o=d();n(o.format("DD"),o.format("MM"),o.format("YYYY")),l.close()},children:"Сегодня"}),e.jsx(B,{onClick:()=>{const o=d().add(1,"day");n(o.format("DD"),o.format("MM"),o.format("YYYY")),l.close()},children:"Завтра"}),e.jsx("div",{className:h.resetButtonWrapper,children:e.jsx(b,{cs:{inner:h.resetButtonInner},onClick:()=>{n("","",""),l.close()},icon:Se})})]})]})})},Ge=n=>s.createElement("svg",{id:"\\u0421\\u043B\\u043E\\u0439_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 24 24",style:{enableBackground:"new 0 0 24 24"},xmlSpace:"preserve",fill:"currentColor",stroke:"transparent",...n},s.createElement("path",{d:"M21,4L21,4c0,1.1-0.9,2-2,2h0c-1.1,0-2-0.9-2-2v0c0-0.6-0.4-1-1-1H8C7.4,3,7,3.4,7,4v0c0,1.1-0.9,2-2,2h0C3.9,6,3,5.1,3,4v0 c0-0.6-0.4-1-1-1h0C0.9,3,0,3.9,0,5v13.5c0,2,1.6,3.5,3.5,3.5h16.9c2,0,3.5-1.6,3.5-3.5V5c0-1.1-0.9-2-2-2h0C21.4,3,21,3.4,21,4z  M19.8,20H4.2C3,20,2,19,2,17.8V9.2C2,8,3,7,4.2,7h15.6C21,7,22,8,22,9.2v8.6C22,19,21,20,19.8,20z"}),s.createElement("path",{d:"M5,5L5,5C4.4,5,4,4.6,4,4V2c0-0.6,0.4-1,1-1h0c0.6,0,1,0.4,1,1v2C6,4.6,5.6,5,5,5z"}),s.createElement("path",{d:"M19,5L19,5c-0.6,0-1-0.4-1-1V2c0-0.6,0.4-1,1-1h0c0.6,0,1,0.4,1,1v2C20,4.6,19.6,5,19,5z"}),s.createElement("path",{d:"M19.5,11h-12C7.2,11,7,10.8,7,10.5v0C7,10.2,7.2,10,7.5,10h12c0.3,0,0.5,0.2,0.5,0.5v0C20,10.8,19.8,11,19.5,11z"}),s.createElement("path",{d:"M19.5,14h-15C4.2,14,4,13.8,4,13.5v0C4,13.2,4.2,13,4.5,13h15c0.3,0,0.5,0.2,0.5,0.5v0C20,13.8,19.8,14,19.5,14z"}),s.createElement("path",{d:"M11.5,17h-7C4.2,17,4,16.8,4,16.5l0,0C4,16.2,4.2,16,4.5,16h7c0.3,0,0.5,0.2,0.5,0.5l0,0C12,16.8,11.8,17,11.5,17z"})),Oe=s.memo(Ge),Ue="_CalendarButton_8kpe7_1",Je="_button_8kpe7_7",Qe="_inner_8kpe7_11",U={CalendarButton:Ue,button:Je,inner:Qe},Ze=({onClick:n})=>e.jsx("div",{className:U.CalendarButton,children:e.jsx(b,{className:U.button,cs:{inner:U.inner},icon:Oe,onClick:n})}),en="_inputs_180q0_1",nn="_short_180q0_7",sn="_long_180q0_10",L={inputs:en,short:nn,long:sn};d.extend(H);const q=s.memo(({label:n,name:c,rules:t,control:a,autoFocus:l})=>{const{field:{onChange:u,onBlur:C,ref:p,value:m},fieldState:{error:N}}=be({name:c,rules:t,control:a}),E=s.useRef(null),Y=s.useRef(null),S=s.useRef(null),[D,w]=s.useState(m!=null&&m.isValid()?m.format("DD"):""),[R,o]=s.useState(m!=null&&m.isValid()?m.format("MM"):""),[x,I]=s.useState(m!=null&&m.isValid()?m.format("YYYY"):"");s.useEffect(()=>{m!=null&&m.isValid()||u(d(""))},[]);const K=(r,_,k,v,f)=>{var te;const i=r.currentTarget,M=r.nativeEvent.inputType==="insertText",g=i.value;let $=g.replace(/\D/,"").substring(0,k),V=i.selectionStart;const le=new RegExp(`(.{${V-1}})(.)(.*)`),se=(te=g.match(le))==null?void 0:te[2],ie=/\D/.test(se);M&&ie&&V--,/[.,]/.test(se)&&($=$.padStart(k,"0")),v($),requestAnimationFrame(()=>i.setSelectionRange(V,V)),f&&$.length>=k&&requestAnimationFrame(()=>{f.focus(),f.setSelectionRange(0,f.value.length)})},X=(r,_,k,v)=>{const f=r.currentTarget,i=f.selectionStart,M=i===f.selectionEnd,g=r.key;if(M)if(_&&(g==="ArrowLeft"||g==="Backspace")&&i===0){g==="Backspace"&&k(V=>V.substring(-1)),_.focus();const $=_.value.length;requestAnimationFrame(()=>_.setSelectionRange($,$))}else v&&g==="ArrowRight"&&i===f.value.length&&(v.focus(),requestAnimationFrame(()=>v.setSelectionRange(0,0)))},G=(r,_,k,v)=>{let i=r.currentTarget.value;const M=Number(i);i===""?i="":Number.isNaN(M)||M<1?i="1":M>_&&(i=String(_)),i=i===""?i:i.padStart(k,"0"),v(i),requestAnimationFrame(()=>{const g=document.activeElement;g!==E.current&&g!==Y.current&&g!==S.current&&(C(),ee(D,R,x))})},ee=(r,_,k)=>{if(r!==""||_!==""||k!==""){let v=d(k,["YYYY","YY"]);v.isValid()||(v=d()),v=v.format("YYYY");let f=d(_,["M","MM"]);f.isValid()||(f=d()),f=f.format("MM");let i=d(r,["D","DD"]);i.isValid()||(i=d()),i=i.format("DD");const M=d(`${i}.${f}.${v}`,["D.M.Y","DD.MM.YYYY"]);w(M.format("DD")),o(M.format("MM")),I(M.format("YYYY")),u(M)}else w(""),o(""),I(""),u(d(""))},O=r=>{const _=r.currentTarget;let k=_.value.length;requestAnimationFrame(()=>_.setSelectionRange(0,k))},ne=F();return e.jsxs("label",{children:[e.jsx(ge,{label:n,error:N}),e.jsxs("div",{className:L.inputs,children:[e.jsx("input",{className:L.short,onFocus:O,onChange:r=>K(r,31,2,w,Y.current),onBlur:r=>G(r,31,2,w),onKeyDown:r=>X(r,null,null,Y.current),value:D,ref:Ye(E,p),placeholder:"д",type:"text",inputMode:"decimal",autoFocus:l}),e.jsx("span",{children:"."}),e.jsx("input",{className:L.short,onFocus:O,onChange:r=>K(r,12,2,o,S.current),onBlur:r=>G(r,12,2,o),onKeyDown:r=>X(r,E.current,w,S.current),value:R,ref:Y,placeholder:"м",type:"text",inputMode:"decimal"}),e.jsx("span",{children:"."}),e.jsx("input",{className:L.long,onFocus:O,onChange:r=>K(r,9999,4,I),onBlur:r=>G(r,9999,4,I),onKeyDown:r=>X(r,Y.current,o,null),value:x,ref:S,placeholder:"г",type:"text",inputMode:"decimal"}),e.jsx(Ze,{onClick:ne.open})]}),e.jsx(Xe,{controls:ne,day:D,month:R,year:x,setDate:ee})]})});d.extend(H);const tn=({controls:n})=>{const c=T.addTask,{control:t,formState:{isValid:a},handleSubmit:l,reset:u}=Q({mode:"onChange",defaultValues:{name:"",desc:""}}),C=p=>{c(p),u(),n.close()};return e.jsx(A,{controls:n,minWidth:300,children:e.jsxs(j,{column:!0,children:[e.jsx(W,{children:"Добавить задачу"}),e.jsxs("form",{onSubmit:l(C),children:[e.jsx(A.Scroller,{children:e.jsxs(j,{column:!0,children:[e.jsx(re,{label:"Название",placeholder:"Сделать...",name:"name",rules:{required:"Обязательное"},control:t,autoFocus:!0}),e.jsx(ce,{label:"Описание",placeholder:"И не забыть...",name:"desc",control:t}),e.jsx(q,{label:"Начало",name:"start",control:t}),e.jsx(q,{label:"Конец",name:"end",control:t})]})}),e.jsxs(Z,{children:[e.jsx(B,{type:"submit",visualDisabled:!a,children:"Добавить"}),e.jsx(B,{onClick:n.close,children:"Отмена"})]})]})]})})},on=n=>({asc:c=>c.sort((t,a)=>t[n]===a[n]?0:t[n]?-1:1),desc:c=>c.sort((t,a)=>t[n]===a[n]?0:t[n]?1:-1)}),an=n=>s.createElement("svg",{id:"\\u0421\\u043B\\u043E\\u0439_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 24 24",style:{enableBackground:"new 0 0 24 24"},xmlSpace:"preserve",fill:"currentColor",stroke:"transparent",...n},s.createElement("path",{d:"M8,20L8,20c-1.1,0-2-0.9-2-2V7c0-1.1,0.9-2,2-2h0c1.1,0,2,0.9,2,2v11C10,19.1,9.1,20,8,20z"}),s.createElement("path",{d:"M16,20L16,20c-1.1,0-2-0.9-2-2V7c0-1.1,0.9-2,2-2h0c1.1,0,2,0.9,2,2v11C18,19.1,17.1,20,16,20z"})),rn=s.memo(an),cn=n=>s.createElement("svg",{id:"\\u0421\\u043B\\u043E\\u0439_1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 24 24",style:{enableBackground:"new 0 0 24 24"},xmlSpace:"preserve",fill:"currentColor",stroke:"transparent",...n},s.createElement("path",{d:"M6,18V6c0-1.3,1.4-2.2,2.6-1.5l10.6,6c1.2,0.7,1.2,2.4,0,3l-10.6,6C7.4,20.2,6,19.3,6,18z"})),ln=s.memo(cn),dn=({handleModifyTask:n,handleRemoveTask:c,controls:t})=>{const a=(l=()=>{})=>()=>{t.close(),l()};return e.jsx(me,{controls:t,children:e.jsxs(j,{column:!0,children:[e.jsx(b,{icon:he,label:"Изменить",onClick:a(n)}),e.jsx(b,{icon:ye,label:"Удалить",onClick:a(c)})]})})};d.extend(H);const un=({id:n,controls:c})=>{const t=T.getTask(n),a=T.modifyTask,{control:l,formState:{isValid:u},handleSubmit:C}=Q({mode:"onChange",defaultValues:{name:t.name,desc:t.desc,start:d(t.start,"DD.MM.YYYY"),end:d(t.end,"DD.MM.YYYY")}}),p=m=>{a(n,m),c.close()};return e.jsx(A,{controls:c,minWidth:300,children:e.jsxs(j,{column:!0,children:[e.jsx(W,{children:"Изменить задачу"}),e.jsxs("form",{onSubmit:C(p),children:[e.jsx(A.Scroller,{children:e.jsxs(j,{column:!0,children:[e.jsx(re,{label:"Название",placeholder:"Сделать...",name:"name",rules:{required:"Обязательное"},control:l,autoFocus:!0}),e.jsx(ce,{label:"Описание",placeholder:"И не забыть...",name:"desc",control:l}),e.jsx(q,{label:"Начало",name:"start",control:l}),e.jsx(q,{label:"Конец",name:"end",control:l})]})}),e.jsxs(Z,{children:[e.jsx(B,{type:"submit",visualDisabled:!u,children:"Сохранить"}),e.jsx(B,{onClick:c.close,children:"Отмена"})]})]})]})})},mn=({id:n,controls:c})=>{const t=T.getTask(n),a=T.removeTask,l=T.disableTaskRemoveConfirmation,{control:u,getValues:C}=Q(),p=()=>{C("disableTaskRemoveConfirmation")&&l(),a(n),c.close()};return e.jsx(A,{controls:c,maxWidth:340,children:e.jsxs(j,{column:!0,children:[e.jsx(W,{children:"Удаление задачи"}),e.jsxs("p",{children:['Вы действительно хотите удалить задачу "',t.name,'"?']}),e.jsx(we,{label:"Не спрашивать снова",name:"disableTaskRemoveConfirmation",control:u,autoFocus:!0}),e.jsxs(Z,{children:[e.jsx(B,{onClick:p,children:"Удалить"}),e.jsx(B,{onClick:c.close,children:"Отмена"})]})]})})},hn="_Task_1ejdu_1",xn="_done_1ejdu_6",pn="_header_1ejdu_10",jn="_desc_1ejdu_10",fn="_actions_1ejdu_24",_n="_button_1ejdu_28",vn="_inner_1ejdu_32",Cn="_p_1ejdu_36",y={Task:hn,done:xn,header:pn,desc:jn,actions:fn,button:_n,inner:vn,p:Cn},kn=s.memo(({task:{id:n,name:c,desc:t,start:a,end:l,done:u}})=>{const C=T.toggleTask,p=T.removeTask,m=ae(R=>R.taskRemoveConfirmation),N=s.useRef(null),E=s.useCallback(()=>xe(N.current),[N]),Y=pe(E),S=F(),D=F(),w=()=>{m?D.open():p(n)};return e.jsxs(je,{className:oe(y.Task,!u&&y.done),children:[e.jsxs(j,{column:!0,children:[e.jsxs(j,{className:y.header,children:[e.jsx(W,{children:c}),e.jsxs(j,{className:y.actions,children:[e.jsx(b,{className:y.button,cs:{inner:y.inner},icon:u?ln:rn,onClick:()=>C(n)}),e.jsx(b,{className:y.button,cs:{inner:y.inner},ref:N,icon:fe,onClick:Y.open})]})]}),(t!==""||a||l)&&e.jsxs(j,{className:y.desc,children:[e.jsx("pre",{children:t}),(a||l)&&e.jsxs(j,{children:[e.jsxs(j,{column:!0,children:[a&&e.jsx("p",{className:y.p,children:"Начало: "}),l&&e.jsx("p",{className:y.p,children:"Завершение: "})]}),e.jsxs(j,{column:!0,children:[a&&e.jsx("p",{children:a}),l&&e.jsx("p",{children:l})]})]})]})]}),e.jsx(dn,{handleModifyTask:S.open,handleRemoveTask:w,controls:Y}),e.jsx(un,{id:n,controls:S}),e.jsx(mn,{id:n,controls:D})]})}),Mn={id:_e("id"),name:z("name"),desc:z("desc"),start:z("start"),end:z("end"),done:on("done")},bn=s.memo(({sort:n})=>{const c=ae(a=>a.tasks),t=s.useMemo(()=>Mn[(n==null?void 0:n.field)??"id"][(n==null?void 0:n.order)??"desc"](c),[c,n]);return e.jsxs(de,{timeout:500,children:[c.length===0&&e.jsx(J,{children:e.jsx(W,{center:!0,indent:!0,children:"Задач не найдено"})}),t.map(a=>e.jsx(J,{children:e.jsx(kn,{task:a})},a.id))]})}),gn=[{value:"id",label:"По умолчанию"},{value:"name",label:"По названию"},{value:"desc",label:"По описанию"},{value:"start",label:"По дате начала"},{value:"end",label:"По дате завершения"},{value:"done",label:"По выполнению"}],yn={id:[{value:"desc",label:"Сначала последние"},{value:"asc",label:"Сначала первые"}],name:[{value:"asc",label:"В алфавитном порядке"},{value:"desc",label:"В обратном порядке"}],desc:[{value:"asc",label:"В алфавитном порядке"},{value:"desc",label:"В обратном порядке"}],start:[{value:"asc",label:"Сначала недавние"},{value:"desc",label:"Сначала давние"}],end:[{value:"asc",label:"Сначала срочные"},{value:"desc",label:"Сначала несрочные"}],done:[{value:"desc",label:"Сначала не выполненные"},{value:"asc",label:"Сначала выполненные"}]},Tn=()=>{const n=ue(u=>u.setCurrentPageTitle);s.useLayoutEffect(()=>n("Задачи"));const c=F(),t=F(),[a,l]=s.useState(null);return e.jsxs(J,{children:[e.jsx(bn,{sort:a}),e.jsx(ve,{children:e.jsxs(j,{children:[e.jsx(b,{icon:Ce,onClick:()=>c.open()}),e.jsx(b,{icon:ke,onClick:()=>t.open()})]})}),e.jsx(tn,{controls:c}),e.jsx(Me,{controls:t,setSort:l,fields:gn,orders:yn})]})};export{Tn as Tasks};
