import{r as o,j as e,G as i,T as C,B as j,L as b,I as f,d as X,c as Y,a as Z,D as ee,u as ne}from"./index-D--iTvp1.js";import{I as N,C as se,M as te,c as le,u as ae,L as oe,a as ce,n as M,s as re,P as ie,b as ue,d as de,S as me}from"./ContextPopup-CsHsCrXn.js";import{u as xe,H as he,b as V,P as g,A as _,M as je,a as v}from"./trashcan-0WT3sUcC.js";import{C as y}from"./Collapser-C7gsJAZe.js";import{S as $}from"./Switch-CIIG4TO_.js";const w=(n,s)=>(n/10**s).toLocaleString("ru-RU",{minimumFractionDigits:s,maximumFractionDigits:s}),pe="_input_1rku8_1",be={input:pe},L=o.memo(({label:n,name:s,rules:t,control:a,precision:l=0,autoFocus:c,cs:u={}})=>{const{field:{onChange:r,onBlur:m,value:S,ref:T},fieldState:{error:D}}=xe({name:s,rules:t,control:a}),[B,q]=o.useState("");o.useEffect(()=>{Number.isInteger(S)||r(0)},[]),o.useEffect(()=>{Number.isInteger(S)&&q(w(S,l).replaceAll(" ",""))},[l,S]);const H=x=>{var I;const W=x.target,P=W.value,k=P.replace(/[^\d.,-]/g,"").replace(".",",").replace(/(?!^)-/g,"");let d=W.selectionStart;const R=k.indexOf(","),G=R===-1?d:R,F=k.replaceAll(",",""),O=new RegExp(`^(.{${G}})(.*)$`),h=F.match(O),z=(l===0?F:h==null?void 0:h[1])||"0",J=((h==null?void 0:h[2])||"0").substring(0,l).padEnd(l,"0"),K=parseInt(z+J),A=x.nativeEvent.inputType==="insertText",Q=new RegExp(`(.{${d-1}})(.)(.*)`),E=(I=P.match(Q))==null?void 0:I[2];A&&/[^\d,]/.test(E)&&d--,A&&/-/.test(E)&&d===0&&d++,r(K),requestAnimationFrame(()=>setTimeout(()=>W.setSelectionRange(d,d),0))},U=x=>{x.target.value==="0,00"&&x.target.setSelectionRange(0,x.target.value.length)};return e.jsxs("label",{children:[e.jsx(he,{className:u.header,label:n,error:D}),e.jsx("input",{className:be.input,onChange:H,onBlur:m,onFocus:U,value:B,ref:T,type:"text",inputMode:"numeric",autoFocus:c})]})}),fe=({controls:n})=>{const s=b.addWallet,{control:t,formState:{isValid:a},handleSubmit:l,reset:c}=V({mode:"onChange",defaultValues:{name:""}}),u=r=>{s(r),c(),n.close()};return e.jsx(g,{controls:n,minWidth:300,children:e.jsxs(i,{column:!0,children:[e.jsx(C,{children:"Добавить счет"}),e.jsxs("form",{onSubmit:l(u),children:[e.jsx(g.Scroller,{children:e.jsxs(i,{column:!0,children:[e.jsx(N,{label:"Название",placeholder:"Наличные...",name:"name",rules:{required:"Обязательное"},control:t,autoFocus:!0}),e.jsx(L,{label:"Баланс",name:"balance",precision:2,control:t}),e.jsx($,{label:"Сделать основным",name:"main",control:t})]})}),e.jsxs(_,{children:[e.jsx(j,{type:"submit",visualDisabled:!a,children:"Добавить"}),e.jsx(j,{onClick:n.close,children:"Отмена"})]})]})]})})},ge=({handleModifyWallet:n,handleRemoveWallet:s,controls:t})=>{const a=(l=()=>{})=>()=>{t.close(),l()};return e.jsx(se,{controls:t,children:e.jsxs(i,{column:!0,children:[e.jsx(f,{icon:te,label:"Изменить",onClick:a(n)}),e.jsx(f,{icon:je,label:"Удалить",onClick:a(s)})]})})};X.extend(Y);const Ce=({id:n,controls:s})=>{const t=b.getWallet(n),a=b.modifyWallet,{control:l,formState:{isValid:c},handleSubmit:u}=V({mode:"onChange",defaultValues:{name:t.name,balance:t.balance,main:t.main}}),r=m=>{a(n,m),s.close()};return e.jsx(g,{controls:s,minWidth:300,children:e.jsxs(i,{column:!0,children:[e.jsx(C,{children:"Изменить счет"}),e.jsxs("form",{onSubmit:u(r),children:[e.jsx(g.Scroller,{children:e.jsxs(i,{column:!0,children:[e.jsx(N,{label:"Название",placeholder:"Наличные...",name:"name",rules:{required:"Обязательное"},control:l,autoFocus:!0}),e.jsx(L,{label:"Баланс",name:"balance",precision:2,control:l}),e.jsx($,{label:"Сделать основным",name:"main",control:l})]})}),e.jsxs(_,{children:[e.jsx(j,{type:"submit",visualDisabled:!c,children:"Сохранить"}),e.jsx(j,{onClick:s.close,children:"Отмена"})]})]})]})})},Se=({id:n,controls:s})=>{const t=b.getWallet(n),a=b.removeWallet,l=()=>{a(n),s.close()};return e.jsx(g,{controls:s,maxWidth:320,children:e.jsxs(i,{column:!0,children:[e.jsx(C,{children:"Удаление задачи"}),e.jsxs("p",{children:['Вы действительно хотите удалить счет "',t.name,'"?']}),e.jsx("p",{children:"Это также удалит все его операции"}),e.jsxs(_,{children:[e.jsx(j,{onClick:l,children:"Удалить"}),e.jsx(j,{onClick:s.close,children:"Отмена"})]})]})})},ve="_Wallet_c7p7y_1",We="_header_c7p7y_5",ye="_button_c7p7y_10",_e="_inner_c7p7y_14",Pe="_main_c7p7y_18",p={Wallet:ve,header:We,button:ye,inner:_e,main:Pe},ke=o.memo(({wallet:{id:n,name:s,balance:t,main:a}})=>{const l=o.useRef(null),c=o.useCallback(()=>le(l.current),[l]),u=ae(c),r=v(),m=v();return e.jsxs(oe,{className:p.Wallet,children:[e.jsxs(i,{column:!0,children:[e.jsxs(i,{className:p.header,children:[e.jsx(C,{children:s}),e.jsx(f,{className:p.button,cs:{inner:p.inner},ref:l,icon:ce,onClick:u.open})]}),e.jsxs("p",{children:["Баланс: ",w(t,2),a&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsx("span",{className:p.main,children:"основной"})]})]})]}),e.jsx(ge,{handleModifyWallet:r.open,handleRemoveWallet:m.open,controls:u}),e.jsx(Ce,{id:n,controls:r}),e.jsx(Se,{id:n,controls:m})]})}),Re={id:M("id"),name:re("name"),balance:M("balance")},Fe=o.memo(({sort:n})=>{const s=Z(a=>a.wallets),t=o.useMemo(()=>Re[(n==null?void 0:n.field)??"id"][(n==null?void 0:n.order)??"desc"](s),[s,n]);return e.jsxs(ee,{timeout:500,children:[s.length===0&&e.jsx(y,{children:e.jsx(C,{center:!0,indent:!0,children:"Счетов не найдено"})}),t.map(a=>e.jsx(y,{children:e.jsx(ke,{wallet:a})},a.id))]})}),Ae=[{value:"id",label:"По умолчанию"},{value:"name",label:"По названию"},{value:"balance",label:"По балансу"}],Ee={id:[{value:"desc",label:"Сначала последние"},{value:"asc",label:"Сначала первые"}],name:[{value:"asc",label:"В алфавитном порядке"},{value:"desc",label:"В обратном порядке"}],balance:[{value:"asc",label:"От наименьшего"},{value:"desc",label:"От наибольшего"}]},we=()=>{const n=ne(c=>c.setCurrentPageTitle);o.useLayoutEffect(()=>n("Счета"));const s=v(),t=v(),[a,l]=o.useState(null);return e.jsxs(y,{children:[e.jsx(Fe,{sort:a}),e.jsx(ie,{children:e.jsxs(i,{children:[e.jsx(f,{icon:ue,onClick:()=>s.open()}),e.jsx(f,{icon:de,onClick:()=>t.open()})]})}),e.jsx(fe,{controls:s}),e.jsx(me,{controls:t,setSort:l,fields:Ae,orders:Ee})]})};export{we as Wallets};
