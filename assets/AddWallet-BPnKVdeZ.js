import{r as p,j as e,c as f,u as y,m as N,B as k}from"./index-DIRvoNUT.js";import{T as E}from"./DateInputContext-TuFDwvvd.js";import{a as w,i as o,u as M}from"./Input.module-DoWDVzPe.js";import"./Collapser-qAEYiKRl.js";import"./index-I1V8wj7M.js";const D="_inputs_1rrdd_1",A="_input_1rrdd_1",S={inputs:D,input:A},K=({name:u,control:i,rules:c,label:d,placeholder:v="",autoFocus:m,precision:s=0})=>{const{field:{onChange:n,onBlur:j},fieldState:{error:l}}=w({name:u,control:i,rules:c,defaultValue:0}),[h,_]=p.useState(""),[b,C]=p.useState(""),x=p.useRef(null),r=p.useRef(null),$=t=>{let a=t.target.value.replace(",",".");a.includes(".")&&(r.current.focus(),r.current.setSelectionRange(0,0)),a=a.replace(/^(-?)0*(\d+)/,"$1$2").replace(/[^\d.-]/g,"").replace(/(?!^)-/g,"").split(".")[0],/^0+$/.test(a)&&(a=""),_(a)},B=t=>{let a=t.target.value.replace(/\D/g,"");a.length>s&&(a=a.slice(0,s)),a.length&&(a=a.padStart("0",s)),C(a)},I=t=>{/^0+$/.test(t.target.value)&&(t.target.value=""),document.activeElement!==r.current&&j()},R=t=>{/^0+$/.test(t.target.value)?t.target.value="":t.target.value&&(t.target.value=t.target.value.padEnd(s,"0")),document.activeElement!==x.current&&j()},F=t=>{t.key==="ArrowRight"&&t.target.selectionStart===t.target.value.length&&setTimeout(()=>{r.current.focus(),r.current.setSelectionRange(0,0)},0)},V=t=>{(t.key==="Backspace"||t.key==="ArrowLeft")&&t.target.selectionStart===0&&t.target.selectionEnd===0&&(t.key==="Backspace"&&_(a=>a.slice(0,-1)),setTimeout(()=>{x.current.focus(),x.current.setSelectionRange(h.length,h.length)},0))};return p.useEffect(()=>{n(+`${h||"0"}.${b||0}`)},[h,b]),e.jsxs("label",{className:o.Input,children:[e.jsxs("div",{className:o.name,children:[e.jsx("span",{children:d}),e.jsx("span",{children:(l==null?void 0:l.message)&&` (${l.message})`})]}),e.jsxs("div",{className:S.inputs,children:[e.jsx("input",{type:"text",inputMode:"decimal",className:f(o.input,S.input),onChange:$,onBlur:I,onKeyDown:F,value:h,placeholder:"0",autoFocus:m,ref:x}),e.jsx("input",{type:"text",inputMode:"decimal",className:f(o.input,S.input),onChange:B,onBlur:R,onKeyDown:V,value:b,placeholder:"0".repeat(s),ref:r,style:{"--precision":s,display:s===0?"none":"block"}})]})]})},T="_Switch_12od4_1",O="_checkbox_12od4_6",W="_thumb_12od4_9",q="_name_12od4_16",g={Switch:T,checkbox:O,thumb:W,name:q},G=({name:u,control:i,rules:c,label:d,autoFocus:v})=>{const{field:{onChange:m,onBlur:s,value:n,ref:j},fieldState:{error:l}}=w({name:u,control:i,rules:c});return e.jsxs("label",{className:f(g.Switch,o.Input),children:[e.jsx("input",{className:f(g.Input,"visually-hidden"),type:"checkbox",value:n,onChange:m,onBlur:s}),e.jsxs("div",{className:f(g.name,o.name),children:[e.jsx("span",{children:d}),e.jsx("span",{children:(l==null?void 0:l.message)&&` (${l.message})`})]}),e.jsx("div",{className:g.checkbox,children:e.jsx("div",{className:g.thumb})})]})},Q=()=>{const u=y(n=>n.isModalOpen),i=y(n=>n.closeModal),{control:c,formState:{isValid:d},handleSubmit:v,setValue:m}=M({mode:"onChange",defaultValues:{name:""}}),s=n=>{m("result",n.balance)};return e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:v(s),children:[e.jsxs("div",{className:N.scroller,children:[e.jsx(E,{name:"name",label:"Название",rules:{required:"обязательное"},autoFocus:u,control:c}),e.jsx(K,{name:"balance",label:"Баланс",precision:2,control:c}),e.jsx(G,{name:"setMain",label:"Сделать основным",control:c})]}),e.jsxs("div",{className:N.actions,children:[e.jsx(k,{visualDisabled:!d,type:"submit",children:"Добавить"}),e.jsx(k,{onClick:i,secondary:!0,children:"Отмена"})]})]})})};export{Q as default};
