import{j as e,G as c,T as d,B as m,L as x,I as h,d as k,c as R,r,a as L,D as I,u as N}from"./index-Drd5J5gP.js";import{I as _,C as $,M as A,c as F,u as T,L as W,a as D,s as E,n as V,P as B,b as q,d as G,S as U}from"./ContextPopup-BhxJ9_H_.js";import{b as S,P as j,A as y,M as H,a as C}from"./Switch-DnfmqdMb.js";import{C as i}from"./Collapser-DASlPNaZ.js";import"./NumberInput-C89ehNoI.js";import{R as M}from"./Radio-CdEP7qV-.js";const O=({controls:s})=>{const t=x.addCategory,{control:o,formState:{isValid:l},handleSubmit:n,reset:a}=S({mode:"onChange",defaultValues:{name:""}}),u=b=>{t(b),a(),s.close()};return e.jsx(j,{controls:s,minWidth:300,children:e.jsxs(c,{column:!0,children:[e.jsx(d,{children:"Добавить категорию"}),e.jsxs("form",{onSubmit:n(u),children:[e.jsx(j.Scroller,{children:e.jsxs(c,{column:!0,children:[e.jsx(_,{label:"Название",placeholder:"Продукты...",name:"name",rules:{required:"Обязательное"},control:o,autoFocus:!0}),e.jsx(M,{label:"Тип",name:"type",options:[{value:"expense",label:"Расходы"},{value:"income",label:"Доходы"}],control:o})]})}),e.jsxs(y,{children:[e.jsx(m,{type:"submit",visualDisabled:!l,children:"Добавить"}),e.jsx(m,{onClick:s.close,children:"Отмена"})]})]})]})})},w="_Category_1cviu_1",z="_header_1cviu_5",J="_button_1cviu_10",K="_inner_1cviu_14",p={Category:w,header:z,button:J,inner:K},Q=({handleModifyWallet:s,handleRemoveWallet:t,controls:o})=>{const l=(n=()=>{})=>()=>{o.close(),n()};return e.jsx($,{controls:o,children:e.jsxs(c,{column:!0,children:[e.jsx(h,{icon:A,label:"Изменить",onClick:l(s)}),e.jsx(h,{icon:H,label:"Удалить",onClick:l(t)})]})})};k.extend(R);const X=({id:s,controls:t})=>{const o=x.getCategory(s),l=x.modifyCategory,{control:n,formState:{isValid:a},handleSubmit:u}=S({mode:"onChange",defaultValues:{name:o.name,type:o.type}}),b=P=>{l(s,P),t.close()};return e.jsx(j,{controls:t,minWidth:300,children:e.jsxs(c,{column:!0,children:[e.jsx(d,{children:"Изменить категорию"}),e.jsxs("form",{onSubmit:u(b),children:[e.jsx(j.Scroller,{children:e.jsxs(c,{column:!0,children:[e.jsx(_,{label:"Название",placeholder:"Продукты...",name:"name",rules:{required:"Обязательное"},control:n,autoFocus:!0}),e.jsx(M,{label:"Тип",name:"type",options:[{value:"expense",label:"Расходы"},{value:"income",label:"Доходы"}],control:n})]})}),e.jsxs(y,{children:[e.jsx(m,{type:"submit",visualDisabled:!a,children:"Сохранить"}),e.jsx(m,{onClick:t.close,children:"Отмена"})]})]})]})})},Y=({id:s,controls:t})=>{const o=x.getCategory(s),l=x.removeCategory,n=()=>{l(s),t.close()};return e.jsx(j,{controls:t,maxWidth:320,children:e.jsxs(c,{column:!0,children:[e.jsx(d,{children:"Удаление категории"}),e.jsxs("p",{children:['Вы действительно хотите удалить категорию "',o.name,'"?']}),e.jsx("p",{children:"Это также удалит все вложенные категории и их операции"}),e.jsxs(y,{children:[e.jsx(m,{onClick:n,children:"Удалить"}),e.jsx(m,{onClick:t.close,children:"Отмена"})]})]})})},f=r.memo(({category:{id:s,name:t}})=>{const o=r.useRef(null),l=r.useCallback(()=>F(o.current),[o]),n=T(l),a=C(),u=C();return e.jsxs(W,{className:p.Category,children:[e.jsxs(c,{className:p.header,children:[e.jsx(d,{children:t}),e.jsx(h,{className:p.button,cs:{inner:p.inner},ref:o,icon:D,onClick:n.open})]}),e.jsx(Q,{handleModifyWallet:a.open,handleRemoveWallet:u.open,controls:n}),e.jsx(X,{id:s,controls:a}),e.jsx(Y,{id:s,controls:u})]})}),Z="_indent_1d0bj_1",ee="_title_1d0bj_5",g={indent:Z,title:ee},v={id:V("id"),name:E("name")},se=r.memo(({sort:s})=>{const t=L(n=>n.categories),o=r.useMemo(()=>v[(s==null?void 0:s.field)??"id"][(s==null?void 0:s.order)??"desc"](t.filter(n=>n.type==="expense")),[t,s]),l=r.useMemo(()=>v[(s==null?void 0:s.field)??"id"][(s==null?void 0:s.order)??"desc"](t.filter(n=>n.type==="income")),[t,s]);return e.jsxs(I,{timeout:500,children:[t.length===0&&e.jsx(i,{children:e.jsx(d,{center:!0,indent:!0,children:"Категорий не найдено"})}),o.length!==0&&e.jsx(i,{children:e.jsx(d,{className:g.title,children:"Категории расходов"})}),o.map(n=>e.jsx(i,{children:e.jsx(f,{category:n})},n.id)),o.length!==0&&e.jsx(i,{children:e.jsx("div",{className:g.indent})}),l.length!==0&&e.jsx(i,{children:e.jsx(d,{className:g.title,children:"Категории доходов"})}),l.map(n=>e.jsx(i,{children:e.jsx(f,{category:n})},n.id))]})}),ne=[{value:"id",label:"По умолчанию"},{value:"name",label:"По названию"}],te={id:[{value:"desc",label:"Сначала последние"},{value:"asc",label:"Сначала первые"}],name:[{value:"asc",label:"В алфавитном порядке"},{value:"desc",label:"В обратном порядке"}]},de=()=>{const s=N(a=>a.setCurrentPageTitle);r.useLayoutEffect(()=>s("Категории"));const t=C(),o=C(),[l,n]=r.useState(null);return e.jsxs(i,{children:[e.jsx(se,{sort:l}),e.jsx(B,{children:e.jsxs(c,{children:[e.jsx(h,{icon:q,onClick:()=>t.open()}),e.jsx(h,{icon:G,onClick:()=>o.open()})]})}),e.jsx(O,{controls:t}),e.jsx(U,{controls:o,setSort:n,fields:ne,orders:te})]})};export{de as Categories};
