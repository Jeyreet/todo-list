import{j as e,G as c,T as g,B as u,L as x,I as m,e as M,d as P,c as _,r as d,f,u as $,D as F,g as L,a as R}from"./index-B7GhJnNH.js";import{I as S,C as A,M as I,c as N,u as T,L as D,a as V,s as B,n as E,P as W,b as q,d as G,S as U}from"./ContextPopup-8VXNmrGe.js";import{b as v,P as j,A as y,M as H,a as b}from"./trashcan-BkybTApV.js";import{C as p}from"./Collapser-BGNvO10H.js";import"./Radio-CZyOvCL0.js";const O=({id:t,controls:s})=>{const o=x.addCategory,{control:r,formState:{isValid:n},handleSubmit:a,reset:l}=v({mode:"onChange",defaultValues:{name:""}}),i=h=>{o({...h,parent:t}),l(),s.close()};return e.jsx(j,{controls:s,minWidth:300,children:e.jsxs(c,{column:!0,children:[e.jsx(g,{children:"Добавить подкатегорию"}),e.jsxs("form",{onSubmit:a(i),children:[e.jsx(j.Scroller,{children:e.jsx(c,{column:!0,children:e.jsx(S,{label:"Название",placeholder:"Продукты...",name:"name",rules:{required:"Обязательное"},control:r,autoFocus:!0})})}),e.jsxs(y,{children:[e.jsx(u,{type:"submit",visualDisabled:!n,children:"Добавить"}),e.jsx(u,{onClick:s.close,children:"Отмена"})]})]})]})})},w=({handleSubcategories:t,handleModifyCategory:s,handleRemoveCategory:o,controls:r})=>{const n=(a=()=>{})=>()=>{r.close(),a()};return e.jsx(A,{controls:r,children:e.jsxs(c,{column:!0,children:[e.jsx(m,{icon:M,label:"Подкатегории",onClick:n(t)}),e.jsx(m,{icon:I,label:"Изменить",onClick:n(s)}),e.jsx(m,{icon:H,label:"Удалить",onClick:n(o)})]})})};P.extend(_);const z=({id:t,controls:s})=>{const o=x.getCategory(t),r=x.modifyCategory,{control:n,formState:{isValid:a},handleSubmit:l}=v({mode:"onChange",defaultValues:{name:o.name,type:o.type}}),i=h=>{r(t,h),s.close()};return e.jsx(j,{controls:s,minWidth:300,children:e.jsxs(c,{column:!0,children:[e.jsx(g,{children:"Изменить категорию"}),e.jsxs("form",{onSubmit:l(i),children:[e.jsx(j.Scroller,{children:e.jsx(c,{column:!0,children:e.jsx(S,{label:"Название",placeholder:"Продукты...",name:"name",rules:{required:"Обязательное"},control:n,autoFocus:!0})})}),e.jsxs(y,{children:[e.jsx(u,{type:"submit",visualDisabled:!a,children:"Сохранить"}),e.jsx(u,{onClick:s.close,children:"Отмена"})]})]})]})})},J=({id:t,controls:s})=>{const o=x.getCategory(t),r=x.removeCategory,n=()=>{r(t),s.close()};return e.jsx(j,{controls:s,maxWidth:320,children:e.jsxs(c,{column:!0,children:[e.jsx(g,{children:"Удаление подкатегории"}),e.jsxs("p",{children:['Вы действительно хотите удалить подкатегорию "',o.name,'"?']}),e.jsx("p",{children:"Это также удалит все подкатегории и их операции"}),e.jsxs(y,{children:[e.jsx(u,{onClick:n,children:"Удалить"}),e.jsx(u,{onClick:s.close,children:"Отмена"})]})]})})},K="_Subcategory_1rnbp_1",Q="_header_1rnbp_5",X="_button_1rnbp_10",Y="_inner_1rnbp_14",C={Subcategory:K,header:Q,button:X,inner:Y},Z=d.memo(({subcategory:{id:t,name:s}})=>{const o=d.useRef(null),r=d.useCallback(()=>N(o.current),[o]),n=T(r),a=b(),l=b(),i=f();return e.jsxs(D,{className:C.Subcategory,children:[e.jsxs(c,{className:C.header,children:[e.jsx(g,{children:s}),e.jsx(m,{className:C.button,cs:{inner:C.inner},ref:o,icon:V,onClick:n.open})]}),e.jsx(w,{handleSubcategories:()=>i(`/categories/${t}`),handleModifyCategory:a.open,handleRemoveCategory:l.open,controls:n}),e.jsx(z,{id:t,controls:a}),e.jsx(J,{id:t,controls:l})]})}),ee={id:E("id"),name:B("name")},se=d.memo(({id:t,sort:s})=>{const o=$(n=>n.categories),r=d.useMemo(()=>ee[(s==null?void 0:s.field)??"id"][(s==null?void 0:s.order)??"desc"](o.filter(n=>n.parent===t)),[o,t,s]);return e.jsxs(F,{timeout:500,children:[r.length===0&&e.jsx(p,{children:e.jsx(g,{center:!0,indent:!0,children:"Подкатегорий не найдено"})}),r.map(n=>e.jsx(p,{children:e.jsx(Z,{subcategory:n})},n.id))]})}),ne=[{value:"id",label:"По умолчанию"},{value:"name",label:"По названию"}],oe={id:[{value:"desc",label:"Сначала последние"},{value:"asc",label:"Сначала первые"}],name:[{value:"asc",label:"В алфавитном порядке"},{value:"desc",label:"В обратном порядке"}]},ie=()=>{const t=L(),s=Number(t.id),o=x.getCategory(s),r=R(k=>k.setCurrentPageTitle);d.useLayoutEffect(()=>r(o?`Подкатегории "${o.name}"`:"Ошибка!"));const n=b(),a=b(),[l,i]=d.useState(null),h=f();return e.jsxs(p,{children:[!o&&e.jsxs(c,{column:!0,children:[e.jsx("p",{children:"Вы перешли на страницу подкатегорий несуществующей категории"}),e.jsx(u,{onClick:()=>h("/categories"),children:"Перейти в категории"})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx(se,{id:s,sort:l}),e.jsx(W,{children:e.jsxs(c,{children:[e.jsx(m,{icon:q,label:"Подкатегория",onClick:()=>n.open()}),e.jsx(m,{icon:G,onClick:()=>a.open()})]})}),e.jsx(O,{id:s,controls:n}),e.jsx(U,{controls:a,setSort:i,fields:ne,orders:oe})]})]})};export{ie as Subcategories};
