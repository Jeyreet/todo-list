import{j as e,G as r,T as d,B as x,L as j,I as m,e as P,d as R,c as $,r as c,f as L,a as N,D as I,u as A}from"./index-C57bLDxE.js";import{I as _,C as F,M as T,c as D,u as E,L as V,a as B,s as W,n as q,P as G,b as U,d as H,S as O}from"./ContextPopup-B7L7NGoK.js";import{b as S,P as C,A as y,M as w,a as g}from"./trashcan-CiGn7zZY.js";import{C as i}from"./Collapser-qxTAF6TF.js";import{R as M}from"./Radio-Bw7ankH_.js";const z=({controls:s})=>{const o=j.addCategory,{control:t,formState:{isValid:l},handleSubmit:n,reset:a}=S({mode:"onChange",defaultValues:{name:""}}),u=h=>{o(h),a(),s.close()};return e.jsx(C,{controls:s,minWidth:300,children:e.jsxs(r,{column:!0,children:[e.jsx(d,{children:"Добавить категорию"}),e.jsxs("form",{onSubmit:n(u),children:[e.jsx(C.Scroller,{children:e.jsxs(r,{column:!0,children:[e.jsx(_,{label:"Название",placeholder:"Продукты...",name:"name",rules:{required:"Обязательное"},control:t,autoFocus:!0}),e.jsx(M,{label:"Тип",name:"type",options:[{value:"expense",label:"Расходы"},{value:"income",label:"Доходы"}],control:t})]})}),e.jsxs(y,{children:[e.jsx(x,{type:"submit",visualDisabled:!l,children:"Добавить"}),e.jsx(x,{onClick:s.close,children:"Отмена"})]})]})]})})},J="_Category_1cviu_1",K="_header_1cviu_5",Q="_button_1cviu_10",X="_inner_1cviu_14",p={Category:J,header:K,button:Q,inner:X},Y=({handleSubcategories:s,handleModifyCategory:o,handleRemoveCategory:t,controls:l})=>{const n=(a=()=>{})=>()=>{l.close(),a()};return e.jsx(F,{controls:l,children:e.jsxs(r,{column:!0,children:[e.jsx(m,{icon:P,label:"Подкатегории",onClick:n(s)}),e.jsx(m,{icon:T,label:"Изменить",onClick:n(o)}),e.jsx(m,{icon:w,label:"Удалить",onClick:n(t)})]})})};R.extend($);const Z=({id:s,controls:o})=>{const t=j.getCategory(s),l=j.modifyCategory,{control:n,formState:{isValid:a},handleSubmit:u}=S({mode:"onChange",defaultValues:{name:t.name,type:t.type}}),h=k=>{l(s,k),o.close()};return e.jsx(C,{controls:o,minWidth:300,children:e.jsxs(r,{column:!0,children:[e.jsx(d,{children:"Изменить категорию"}),e.jsxs("form",{onSubmit:u(h),children:[e.jsx(C.Scroller,{children:e.jsxs(r,{column:!0,children:[e.jsx(_,{label:"Название",placeholder:"Продукты...",name:"name",rules:{required:"Обязательное"},control:n,autoFocus:!0}),e.jsx(M,{label:"Тип",name:"type",options:[{value:"expense",label:"Расходы"},{value:"income",label:"Доходы"}],control:n})]})}),e.jsxs(y,{children:[e.jsx(x,{type:"submit",visualDisabled:!a,children:"Сохранить"}),e.jsx(x,{onClick:o.close,children:"Отмена"})]})]})]})})},ee=({id:s,controls:o})=>{const t=j.getCategory(s),l=j.removeCategory,n=()=>{l(s),o.close()};return e.jsx(C,{controls:o,maxWidth:320,children:e.jsxs(r,{column:!0,children:[e.jsx(d,{children:"Удаление категории"}),e.jsxs("p",{children:['Вы действительно хотите удалить категорию "',t.name,'"?']}),e.jsx("p",{children:"Это также удалит все подкатегории и их операции"}),e.jsxs(y,{children:[e.jsx(x,{onClick:n,children:"Удалить"}),e.jsx(x,{onClick:o.close,children:"Отмена"})]})]})})},f=c.memo(({category:{id:s,name:o}})=>{const t=c.useRef(null),l=c.useCallback(()=>D(t.current),[t]),n=E(l),a=g(),u=g(),h=L();return e.jsxs(V,{className:p.Category,children:[e.jsxs(r,{className:p.header,children:[e.jsx(d,{children:o}),e.jsx(m,{className:p.button,cs:{inner:p.inner},ref:t,icon:B,onClick:n.open})]}),e.jsx(Y,{handleSubcategories:()=>h(`/categories/${s}`),handleModifyCategory:a.open,handleRemoveCategory:u.open,controls:n}),e.jsx(Z,{id:s,controls:a}),e.jsx(ee,{id:s,controls:u})]})}),se="_indent_1d0bj_1",ne="_title_1d0bj_5",b={indent:se,title:ne},v={id:q("id"),name:W("name")},oe=c.memo(({sort:s})=>{const o=N(n=>n.categories),t=c.useMemo(()=>v[(s==null?void 0:s.field)??"id"][(s==null?void 0:s.order)??"desc"](o.filter(n=>n.type==="expense")),[o,s]),l=c.useMemo(()=>v[(s==null?void 0:s.field)??"id"][(s==null?void 0:s.order)??"desc"](o.filter(n=>n.type==="income")),[o,s]);return e.jsxs(I,{timeout:500,children:[o.length===0&&e.jsx(i,{children:e.jsx(d,{center:!0,indent:!0,children:"Категорий не найдено"})}),t.length!==0&&e.jsx(i,{children:e.jsx(d,{className:b.title,children:"Категории расходов"})}),t.map(n=>e.jsx(i,{children:e.jsx(f,{category:n})},n.id)),t.length!==0&&e.jsx(i,{children:e.jsx("div",{className:b.indent})}),l.length!==0&&e.jsx(i,{children:e.jsx(d,{className:b.title,children:"Категории доходов"})}),l.map(n=>e.jsx(i,{children:e.jsx(f,{category:n})},n.id))]})}),te=[{value:"id",label:"По умолчанию"},{value:"name",label:"По названию"}],le={id:[{value:"desc",label:"Сначала последние"},{value:"asc",label:"Сначала первые"}],name:[{value:"asc",label:"В алфавитном порядке"},{value:"desc",label:"В обратном порядке"}]},ue=()=>{const s=A(a=>a.setCurrentPageTitle);c.useLayoutEffect(()=>s("Категории"));const o=g(),t=g(),[l,n]=c.useState(null);return e.jsxs(i,{children:[e.jsx(oe,{sort:l}),e.jsx(G,{children:e.jsxs(r,{children:[e.jsx(m,{icon:U,onClick:()=>o.open()}),e.jsx(m,{icon:H,onClick:()=>t.open()})]})}),e.jsx(z,{controls:o}),e.jsx(O,{controls:t,setSort:n,fields:te,orders:le})]})};export{ue as Categories};
