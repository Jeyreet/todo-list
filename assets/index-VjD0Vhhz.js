import{r as o,j as e,G as i,T as g,B as j,L as b,I as f,d as X,c as Y,u as Z,D as ee,a as se}from"./index-B7GhJnNH.js";import{I as N,C as ne,M as le,c as te,u as ae,L as oe,a as ce,n as F,s as re,P as ie,b as ue,d as de,S as me}from"./ContextPopup-8VXNmrGe.js";import{u as xe,H as he,b as V,P as C,A as _,M as je,a as S}from"./trashcan-BkybTApV.js";import{C as y}from"./Collapser-BGNvO10H.js";import{S as $}from"./Switch-Be-6ButQ.js";import{m as w}from"./precision-DcE7frbA.js";const pe="_input_1rku8_1",be={input:pe},T=o.memo(({label:s,name:n,rules:l,control:a,precision:t=0,autoFocus:c,cs:u={}})=>{const{field:{onChange:r,onBlur:m,value:v,ref:L},fieldState:{error:D}}=xe({name:n,rules:l,control:a}),[B,q]=o.useState("");o.useEffect(()=>{Number.isInteger(v)||r(0)},[]),o.useEffect(()=>{Number.isInteger(v)&&q(w(v,t).replaceAll(" ",""))},[t,v]);const H=x=>{var M;const W=x.target,P=W.value,k=P.replace(/[^\d.,-]/g,"").replace(".",",").replace(/(?!^)-/g,"");let d=W.selectionStart;const R=k.indexOf(","),O=R===-1?d:R,A=k.replaceAll(",",""),U=new RegExp(`^(.{${O}})(.*)$`),h=A.match(U),z=(t===0?A:h==null?void 0:h[1])||"0",J=((h==null?void 0:h[2])||"0").substring(0,t).padEnd(t,"0"),K=parseInt(z+J),E=x.nativeEvent.inputType==="insertText",Q=new RegExp(`(.{${d-1}})(.)(.*)`),I=(M=P.match(Q))==null?void 0:M[2];E&&/[^\d,]/.test(I)&&d--,E&&/-/.test(I)&&d===0&&d++,r(K),requestAnimationFrame(()=>setTimeout(()=>W.setSelectionRange(d,d),0))},G=x=>{x.target.value==="0,00"&&x.target.setSelectionRange(0,x.target.value.length)};return e.jsxs("label",{children:[e.jsx(he,{className:u.header,label:s,error:D}),e.jsx("input",{className:be.input,onChange:H,onBlur:m,onFocus:G,value:B,ref:L,type:"text",inputMode:"numeric",autoFocus:c})]})}),fe=({controls:s})=>{const n=b.addWallet,{control:l,formState:{isValid:a},handleSubmit:t,reset:c}=V({mode:"onChange",defaultValues:{name:""}}),u=r=>{n(r),c(),s.close()};return e.jsx(C,{controls:s,minWidth:300,children:e.jsxs(i,{column:!0,children:[e.jsx(g,{children:"Добавить счет"}),e.jsxs("form",{onSubmit:t(u),children:[e.jsx(C.Scroller,{children:e.jsxs(i,{column:!0,children:[e.jsx(N,{label:"Название",placeholder:"Наличные...",name:"name",rules:{required:"Обязательное"},control:l,autoFocus:!0}),e.jsx(T,{label:"Баланс",name:"balance",precision:2,control:l}),e.jsx($,{label:"Сделать основным",name:"main",control:l})]})}),e.jsxs(_,{children:[e.jsx(j,{type:"submit",visualDisabled:!a,children:"Добавить"}),e.jsx(j,{onClick:s.close,children:"Отмена"})]})]})]})})},Ce=({handleModifyWallet:s,handleRemoveWallet:n,controls:l})=>{const a=(t=()=>{})=>()=>{l.close(),t()};return e.jsx(ne,{controls:l,children:e.jsxs(i,{column:!0,children:[e.jsx(f,{icon:le,label:"Изменить",onClick:a(s)}),e.jsx(f,{icon:je,label:"Удалить",onClick:a(n)})]})})};X.extend(Y);const ge=({id:s,controls:n})=>{const l=b.getWallet(s),a=b.modifyWallet,{control:t,formState:{isValid:c},handleSubmit:u}=V({mode:"onChange",defaultValues:{name:l.name,balance:l.balance,main:l.main}}),r=m=>{a(s,m),n.close()};return e.jsx(C,{controls:n,minWidth:300,children:e.jsxs(i,{column:!0,children:[e.jsx(g,{children:"Изменить счет"}),e.jsxs("form",{onSubmit:u(r),children:[e.jsx(C.Scroller,{children:e.jsxs(i,{column:!0,children:[e.jsx(N,{label:"Название",placeholder:"Наличные...",name:"name",rules:{required:"Обязательное"},control:t,autoFocus:!0}),e.jsx(T,{label:"Баланс",name:"balance",precision:2,control:t}),e.jsx($,{label:"Сделать основным",name:"main",control:t})]})}),e.jsxs(_,{children:[e.jsx(j,{type:"submit",visualDisabled:!c,children:"Сохранить"}),e.jsx(j,{onClick:n.close,children:"Отмена"})]})]})]})})},ve=({id:s,controls:n})=>{const l=b.getWallet(s),a=b.removeWallet,t=()=>{a(s),n.close()};return e.jsx(C,{controls:n,maxWidth:320,children:e.jsxs(i,{column:!0,children:[e.jsx(g,{children:"Удаление задачи"}),e.jsxs("p",{children:['Вы действительно хотите удалить счет "',l.name,'"?']}),e.jsx("p",{children:"Это также удалит все его операции"}),e.jsxs(_,{children:[e.jsx(j,{onClick:t,children:"Удалить"}),e.jsx(j,{onClick:n.close,children:"Отмена"})]})]})})},Se="_Wallet_c7p7y_1",We="_header_c7p7y_5",ye="_button_c7p7y_10",_e="_inner_c7p7y_14",Pe="_main_c7p7y_18",p={Wallet:Se,header:We,button:ye,inner:_e,main:Pe},ke=o.memo(({wallet:{id:s,name:n,balance:l,main:a}})=>{const t=o.useRef(null),c=o.useCallback(()=>te(t.current),[t]),u=ae(c),r=S(),m=S();return e.jsxs(oe,{className:p.Wallet,children:[e.jsxs(i,{column:!0,children:[e.jsxs(i,{className:p.header,children:[e.jsx(g,{children:n}),e.jsx(f,{className:p.button,cs:{inner:p.inner},ref:t,icon:ce,onClick:u.open})]}),e.jsxs("p",{children:["Баланс: ",w(l,2),a&&e.jsxs(e.Fragment,{children:[" ","— ",e.jsx("span",{className:p.main,children:"основной"})]})]})]}),e.jsx(Ce,{handleModifyWallet:r.open,handleRemoveWallet:m.open,controls:u}),e.jsx(ge,{id:s,controls:r}),e.jsx(ve,{id:s,controls:m})]})}),Re={id:F("id"),name:re("name"),balance:F("balance")},Ae=o.memo(({sort:s})=>{const n=Z(a=>a.wallets),l=o.useMemo(()=>Re[(s==null?void 0:s.field)??"id"][(s==null?void 0:s.order)??"desc"](n),[n,s]);return e.jsxs(ee,{timeout:500,children:[n.length===0&&e.jsx(y,{children:e.jsx(g,{center:!0,indent:!0,children:"Счетов не найдено"})}),l.map(a=>e.jsx(y,{children:e.jsx(ke,{wallet:a})},a.id))]})}),Ee=[{value:"id",label:"По умолчанию"},{value:"name",label:"По названию"},{value:"balance",label:"По балансу"}],Ie={id:[{value:"desc",label:"Сначала последние"},{value:"asc",label:"Сначала первые"}],name:[{value:"asc",label:"В алфавитном порядке"},{value:"desc",label:"В обратном порядке"}],balance:[{value:"asc",label:"От наименьшего"},{value:"desc",label:"От наибольшего"}]},Te=()=>{const s=se(c=>c.setCurrentPageTitle);o.useLayoutEffect(()=>s("Счета"));const n=S(),l=S(),[a,t]=o.useState(null);return e.jsxs(y,{children:[e.jsx(Ae,{sort:a}),e.jsx(ie,{children:e.jsxs(i,{children:[e.jsx(f,{icon:ue,onClick:()=>n.open()}),e.jsx(f,{icon:de,onClick:()=>l.open()})]})}),e.jsx(fe,{controls:n}),e.jsx(me,{controls:l,setSort:t,fields:Ee,orders:Ie})]})};export{Te as Wallets};
