import{j as e,c as D,r as p,B as m,b as Y,u as g,m as C}from"./index-DI-lcmEO.js";import{a as I,i as j,u as k,A as N}from"./AreaInput-CzV_7cT6.js";import{d as x,r as $}from"./Tasks-CP0q5iPC.js";import"./Title-BpuQRdZp.js";const w="_input_gr0pc_1",R={input:w},E=({name:s,control:n,rules:r,label:t,type:c="text",placeholder:o="",autoFocus:d})=>{const{field:{onChange:a,onBlur:l,value:i,ref:u},fieldState:{error:h}}=I({name:s,control:n,rules:r});return e.jsxs("label",{className:j.Input,children:[e.jsxs("div",{className:j.name,children:[e.jsx("span",{children:t}),e.jsx("span",{children:(h==null?void 0:h.message)&&` (${h.message})`})]}),e.jsx("input",{className:D(j.input,R.input),onChange:a,onBlur:l,value:i??"",name:s,ref:u,type:c,placeholder:o,autoFocus:d})]})},M=p.createContext(null),G=({children:s,...n})=>{const[r,t]=p.useState(!1),c=p.useRef(null),o=p.useRef(null),d=()=>{t(!0)},a=()=>{t(!1)},l=()=>{t(u=>!u)},i=()=>{if(!c.current||!o.current)return;const u=c.current.getBoundingClientRect(),h=o.current.getBoundingClientRect();o.current.style.left=`${u.left}px`,o.current.style.width=`${u.width}px`,window.innerHeight-u.bottom>h.height?o.current.style.top=`${u.bottom}px`:o.current.style.top=`${u.top-h.height}px`};return p.useEffect(()=>{i()},[r]),p.useEffect(()=>(i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)),[]),e.jsx(M.Provider,{value:{isOpen:r,open:d,close:a,toggle:l,inputGroupRef:c,calendarRef:o,updatePosition:i,...n},children:s})},f=()=>p.useContext(M),B="_InputGroup_wv5hn_1",O="_input_wv5hn_11",b={InputGroup:B,input:O},S=()=>{const{onChange:s,onBlur:n,value:r,name:t,ref:c,autoFocus:o,toggle:d,inputGroupRef:a}=f();return e.jsxs("div",{className:b.InputGroup,ref:a,children:[e.jsx("input",{className:D(j.input,b.input),onChange:s,onBlur:n,value:r,name:t,ref:c,type:"date",autoFocus:o,onClick:l=>l.preventDefault()}),e.jsx(m,{onClick:d,tabIndex:"-1",children:"К"})]})},F="_Controls_2rxsc_1",A="_text_2rxsc_13",v={Controls:F,text:A},P=()=>{const{value:s,onChange:n,close:r}=f(),t=p.useMemo(()=>x(s).get("month"),[s]),c=p.useMemo(()=>x(s).get("year"),[s]),o=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],d=()=>{n(x(s).add(1,"month").format("YYYY-MM-DD"))},a=()=>{n(x(s).add(-1,"month").format("YYYY-MM-DD"))},l=()=>{n(x().format("YYYY-MM-DD"))};return e.jsxs("div",{className:v.Controls,children:[e.jsx(m,{onClick:a,tabIndex:"-1",children:"<"}),e.jsxs("div",{className:v.text,children:[o[t]," ",c," г."]}),e.jsx(m,{onClick:d,tabIndex:"-1",children:">"}),e.jsx(m,{onClick:l,tabIndex:"-1",children:"Сбр"}),e.jsx(m,{onClick:r,tabIndex:"-1",children:"Ок"})]})},T="_Days_cxipy_1",V={Days:T},q="_weekday_1nplf_1",z={weekday:q},L=()=>e.jsx(e.Fragment,{children:["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"].map((s,n)=>e.jsx("div",{className:z.weekday,children:s},n))}),H=()=>{const{value:s}=f(),n=x(s).startOf("month"),r=n.day()===0?6:n.day()-1;return e.jsx(e.Fragment,{children:Array.from({length:r}).map((t,c)=>e.jsx("div",{},c))})},W="_button_qxs5n_1",J={button:W},K=()=>{const{value:s,onChange:n,close:r}=f(),t=x(s),c=t.date(),o=t.startOf("month").daysInMonth(),d=a=>{r(),n(x(s).date(a).format("YYYY-MM-DD"))};return e.jsx(e.Fragment,{children:Array.from({length:o}).map((a,l)=>e.jsx(m,{className:J.button,disabled:l+1===c,onClick:()=>d(l+1),tabIndex:"-1",children:l+1},l))})},Q=()=>e.jsxs("div",{className:V.Days,children:[e.jsx(L,{}),e.jsx(H,{}),e.jsx(K,{})]}),U=({children:s})=>{const n=document.getElementById("portal");return $.createPortal(s,n)},X="_Calendar_15abb_1",Z="_inner_15abb_23",ee="_hider_15abb_93",se="_padding_15abb_101",_={Calendar:X,inner:Z,hider:ee,padding:se},ne=()=>{const{isOpen:s,close:n,calendarRef:r}=f();return Y(n,s),e.jsx(U,{children:e.jsx("div",{className:_.Calendar,inert:!s,onClick:n,children:e.jsx("div",{className:_.inner,ref:r,onClick:t=>t.stopPropagation(),children:e.jsx("div",{className:_.hider,children:e.jsxs("div",{className:_.padding,children:[e.jsx(P,{}),e.jsx(Q,{})]})})})})})},te=()=>{const{label:s,error:n}=f();return e.jsxs("div",{className:j.name,children:[e.jsx("span",{children:s}),e.jsx("span",{children:(n==null?void 0:n.message)&&` (${n.message})`})]})},y=({name:s,control:n,rules:r,label:t,autoFocus:c})=>{const{field:{onChange:o,onBlur:d,value:a,ref:l},fieldState:{error:i}}=I({name:s,control:n,rules:r,defaultValue:x().format("YYYY-MM-DD")});return e.jsx(G,{label:t,autoFocus:c,onChange:o,onBlur:d,value:a,ref:l,error:i,children:e.jsxs("label",{className:j.Input,children:[e.jsx(te,{}),e.jsx(S,{}),e.jsx(ne,{})]})})},le=()=>{const s=g(a=>a.isModalOpen),n=g(a=>a.closeModal),r=g(a=>a.addTask),{control:t,formState:{isValid:c},handleSubmit:o}=k({mode:"onChange",defaultValues:{name:""}}),d=a=>{n(),r(a)};return e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:o(d),children:[e.jsxs("div",{className:C.scroller,children:[e.jsx(E,{name:"name",label:"Название",rules:{required:"обязательное"},autoFocus:s,control:t}),e.jsx(N,{name:"desc",label:"Описание",control:t}),e.jsx(y,{name:"start",label:"Начало",control:t}),e.jsx(y,{name:"end",label:"Конец",control:t})]}),e.jsxs("div",{className:C.actions,children:[e.jsx(m,{visualDisabled:!c,type:"submit",children:"Добавить"}),e.jsx(m,{onClick:n,secondary:!0,children:"Отмена"})]})]})})};export{le as default};
